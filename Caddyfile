# Caddyfile for LiquidCrypto
# IP-only mode (no domain/SSL yet)

:80 {
    # Serve frontend static files
    root * /srv
    file_server
    
    # API reverse proxy to backend
    handle /api/* {
        reverse_proxy backend:3000
    }
    
    # WebSocket upgrade support
    handle /ws/* {
        reverse_proxy backend:3000
    }
    
    # A2A agent endpoints
    handle /agents/* {
        reverse_proxy backend:3000
    }
    
    # SPA fallback - serve index.html for all other routes
    try_files {path} /index.html
    
    # Compression
    encode gzip
    
    # Cache static assets
    @static {
        path *.js *.css *.png *.jpg *.svg *.woff2 *.ico
    }
    header @static Cache-Control "public, max-age=31536000, immutable"
}

# When you have a domain, replace the above with:
# liquidcrypto.yourdomain.com {
#     # Same config - Caddy auto-provisions HTTPS
#     root * /srv
#     file_server
#     handle /api/* {
#         reverse_proxy backend:3000
#     }
#     handle /ws/* {
#         reverse_proxy backend:3000
#     }
#     handle /agents/* {
#         reverse_proxy backend:3000
#     }
#     try_files {path} /index.html
#     encode gzip
# }
